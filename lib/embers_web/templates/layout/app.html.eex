<!DOCTYPE html>
<html>
<head>
	<!--
                      .' @`._
               ...._.'  ,__.-;
             /`           .-'
         __./'       ,  .'
        (.-'''---.    \`._  Hippity hoppity
       (  .______.'.-' `-.`
        `-..____`-.
                ````    Get out of my property
	-->
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- Pogressive web app manifest -->
	<link rel="manifest" href="/manifest.json">
	<meta name="mobile-web-app-capable" content="yes">

	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#26272b">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#26272b">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<link rel="icon" href="/favicon.ico?v=3" />
	<style type="text/css">
		@keyframes load{
			from{
				background-position:left;
			}to{
				background-position:right;
			}
		}
		#loader{
			width: 100%;
			height: 100%;
			padding: 30px;
			z-index: 3;
			position:fixed;
			background: #26272b;/*$dark*/
			box-sizing: border-box;
			display: flex;
			justify-content: center;
			align-items: center;
		}
		#loader:before{
			content: '';
			z-index: 1;
			display: block;
			width: 100px;
			height: 100px;
			position: absolute;
			left: 30px;
			bottom: 30px;
			background-position: left;
			background-size: auto 100%;
			background:url('/img/loading/_load_16c.png') no-repeat;
			animation: load 1s steps(14) infinite;
		}
		#loader p{
			z-index: 0;
			width: auto;
			height: auto;
			text-align: center;
			color: rgba(255,255,255,0.3);
			font-size: 22px;
			font-style: italic;
			margin: 0 10%;
		}
		#loader p img{
			display: block;
			width: auto;
			height: 180px;
			background: transparent;
			margin: 0 auto 30px auto;
		}
	</style>
	<link href="<%= static_path(@conn, "/css/main.css") %>" rel="stylesheet">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.9/css/all.css" integrity="sha384-5SOiIsAziJl6AWe0HWRKTXlfcSHKmYV4RBF18PPJ173Kzn7jzMyFuTtk8JA7QQG1" crossorigin="anonymous">
</head>
<body>
	<div id="loader" class="not-vex">
		<p>Cargando!</p>
	</div>
	<%= render @view_module, @view_template, assigns %>
	<script type="text/javascript">
		var appData = {};
		appData.csrfToken = <%= raw Poison.encode!(Plug.CSRFProtection.get_csrf_token()) %>;
		appData.user = null;
		appData.realtime = null;
		appData.recaptcha = "6Lde6G4UAAAAAN2QJXkcOnuwzJY4na6SH5vs5ZGl";

		<%= if @current_user do %>
		appData.user = {
			id: "<%= Embers.Helpers.IdHasher.encode(@user.id) %>",
			username: "<%= @user.username %>",
			email:"<%= @user.email %>",
      permissions: [],

      bio: "<%= @user.meta.bio %>",
      cover: "<%= @user.meta.cover %>",
      avatar: {
        small: "<%= @user.meta.avatar.small %>",
        medium: "<%= @user.meta.avatar.medium %>",
        big: "<%= @user.meta.avatar.big %>"
      },

      settings: {
        content_nsfw: "<%= @user.settings.content_nsfw %>",
        content_lowres_images: <%= @user.settings.content_lowres_images %>,
        privacy_show_status: <%= @user.settings.privacy_show_status %>,
        privacy_show_reactions: <%= @user.settings.privacy_show_reactions %>
      }
		};
		<% end %>

		window.appData = appData;
	</script>
	<script src="<%= static_path(@conn, "/js/manifest.js") %>" async></script>
	<script src="<%= static_path(@conn, "/js/vendor.js") %>" async></script>
	<script src="<%= static_path(@conn, "/js/app.js") %>" async></script>
	<script type="text/javascript">
		if ('serviceWorker' in navigator) {
			//This is the service worker with the combined offline experience (Offline page + Offline copy of pages)
			navigator.serviceWorker.register('/service-worker.js').then(function(registration){
				console.log('Service worker has been registered for scope: '+ registration.scope);
			}).catch(function(error) {
				console.log('Service worker registration failed:', error);
			});
		}else{
			console.log('Service workers are not supported.');
		}
	</script>
</body>
</html>
